generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id           String    @id @default(cuid())
  name         String?
  email        String    @unique
  passwordHash String
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  months    MonthData[]
  capex     Capex[]
  cashflows Cashflow[]
  kpis      KPI[]
}

model MonthData {
  id            String  @id @default(cuid())
  userId        String
  user          User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  month         String
  revenuePlan   Int     @default(0)
  revenueActual Int     @default(0)
  payroll       Int     @default(0)
  rent          Int     @default(0)
  marketing     Int     @default(0)
  fulfillment   Int     @default(0)
  itAdmin       Int     @default(0)
  otherOpex     Int     @default(0)

  @@unique([userId, month])
}

model Capex {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  date      DateTime
  category  String
  amount    Int
  comment   String?
  createdAt DateTime @default(now())
}

model Cashflow {
  id             String   @id @default(cuid())
  userId         String
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  month          String
  openingCash    Int      @default(0)
  cashIn         Int      @default(0)
  cashOut        Int      @default(0)
  endingCash     Int      @default(0)
  loansDrawn     Int      @default(0)
  loanRepayments Int      @default(0)

  @@unique([userId, month])
}

model KPI {
  id               String   @id @default(cuid())
  userId           String
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  month            String
  sessions         Int      @default(0)
  orders           Int      @default(0)
  conversionRate   Float    @default(0)
  avgOrderValue    Int      @default(0)
  avgItemsPerOrder Float    @default(0)
  returnRate       Float    @default(0)
  discountRate     Float    @default(0)
  newCustomerShare Float    @default(0)

  @@unique([userId, month])
}
